import {
  getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc,
  getDoc, setDoc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


document.addEventListener("DOMContentLoaded", () => {
  let diaryData = [];
  let filteredData = [];
  let currentIndex = 0;
  let editingEntryId = null;
  let editingEntryUid = null; // ‚ÜêËøΩÂä†ÔºöÁ∑®ÈõÜÂØæË±°„ÅÆÊäïÁ®øËÄÖUID„Çí‰øùÊåÅ
  // --- „Éó„É≠„Éï„Ç£„Éº„É´ÂèñÂæó„Ç≠„É£„ÉÉ„Ç∑„É•Ôºàuid ‚Üí {iconUrl}Ôºâ ---
const profileCache = new Map();

async function getProfile(uid){
  if(!uid) return {};
  if(profileCache.has(uid)) return profileCache.get(uid);
  try{
    const ref = window.doc(window.db, "profiles", uid);
    const snap = await getDoc(ref);
    const data = snap.exists() ? snap.data() : {};
    profileCache.set(uid, data);
    return data;
  }catch(e){
    console.warn("profile load error", e);
    return {};
  }
}

async function saveProfile(uid, iconUrl){
  const ref = window.doc(window.db, "profiles", uid);
  await setDoc(ref, { iconUrl }, { merge: true });
  profileCache.set(uid, { iconUrl });
}

let selectedIcon = null;

// ÂàùÊúüÔºö„Éó„É≠„Éï„Ç£„Éº„É´„Åå„ÅÇ„Çå„Å∞ÈÅ∏ÊäûÁä∂ÊÖã„Å´ÂèçÊò†
(async ()=>{
  const uid = window.currentUser?.uid;
  const prof = await getProfile(uid);
  if (prof?.iconUrl) {
    selectedIcon = prof.iconUrl;
    document.querySelectorAll(".profile-icon").forEach(i=>{
      if (i.dataset.icon === selectedIcon) i.classList.add("selected");
    });
  }
})();

// „ÇØ„É™„ÉÉ„ÇØÔºöÈÅ∏ÊäûÔºÜÂç≥‰øùÂ≠ò ‚Üí Ë°®Á§∫Êõ¥Êñ∞
document.querySelectorAll(".profile-icon").forEach(icon => {
  icon.addEventListener("click", async () => {
    document.querySelectorAll(".profile-icon").forEach(i => i.classList.remove("selected"));
    icon.classList.add("selected");
    selectedIcon = icon.dataset.icon;

    const uid = window.currentUser?.uid;
    if (!uid) { alert("„É≠„Ç∞„Ç§„É≥‰∏≠„Åß„Åô„ÄÇÊï∞ÁßíÂæå„Å´„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ"); return; }

    try{
      await saveProfile(uid, selectedIcon);
      // ÊúÄÊñ∞Ë°®Á§∫„Å´„ÇÇÂèçÊò†
      displayEntry();
    }catch(e){
      console.error(e);
      alert("„Ç¢„Ç§„Ç≥„É≥„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÈÄö‰ø°Áí∞Â¢É„Çí„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ");
    }
  });
});


  
  // „Çπ„Éó„É©„ÉÉ„Ç∑„É•ÈùûË°®Á§∫Âá¶ÁêÜÔºà„Åµ„Çè„Å£„Å®Ê∂à„ÅôÔºâ
  const splash = document.getElementById("splash-screen");
  if (splash) {
    setTimeout(() => {
      splash.style.transition = "opacity 1s ease";
      splash.style.opacity = "0";
      setTimeout(() => {
        splash.style.display = "none";
      }, 1000);
    }, 800);
  }
document.getElementById("closeFormBtn")?.addEventListener("click", function () {
    const formWrapper = document.querySelector(".form-wrapper");
    if (formWrapper) {
      formWrapper.classList.remove("active"); // ‚Üê classÂà∂Âæ°„Åå„Åä„Åô„Åô„ÇÅ
    }
  });

  // ...‰ªñ„ÅÆÂá¶ÁêÜ„ÅÆÁ∂ö„Åç
  // ÊäïÁ®øË™≠„ÅøËæº„Åø„ÉªË°®Á§∫
  async function loadEntries() {
    diaryData = [];
    const querySnapshot = await window.getDocs(window.collection(window.db, "diaries"));
    querySnapshot.forEach(doc => {
      diaryData.push({ ...doc.data(), id: doc.id });
    });
    diaryData.sort((a, b) => new Date(b.date) - new Date(a.date));
    filteredData = [...diaryData];
    currentIndex = 0;
  }

  function formatDate(iso) {
    const d = new Date(iso);
    return `${d.getFullYear()}Âπ¥${d.getMonth() + 1}Êúà${d.getDate()}Êó•`;
  }

  function convertNewlinesToBr(text) {
    return text.replace(/\n/g, "<br>");
  }

  function createExpandableContent(text) {
  const wrapper = document.createElement("div");
  wrapper.className = "expandable-content";

  const p = document.createElement("p");
  p.innerHTML = convertNewlinesToBr(text);
  p.classList.add("collapsed");
  wrapper.appendChild(p);

  if (text.length > 100) {
    const btn = document.createElement("button");
    btn.className = "readmore-btn";
    btn.textContent = "Á∂ö„Åç„ÇíË™≠„ÇÄ";

    btn.addEventListener("click", () => {
      if (p.classList.contains("collapsed")) {
        p.classList.remove("collapsed");
        btn.textContent = "Èñâ„Åò„Çã";
      } else {
        p.classList.add("collapsed");
        btn.textContent = "Á∂ö„Åç„ÇíË™≠„ÇÄ";
      }
    });

    wrapper.appendChild(btn);
  }

  return wrapper;
}

  function displayEntry() {
    const container = document.getElementById("diary-container");
    container.innerHTML = "";
    const entry = filteredData[currentIndex];
    if (!entry) return;

    const isOwner = entry.uid === window.currentUser?.uid;
    const likedKey = `liked_${entry.id}`;
    const alreadyLiked = localStorage.getItem(likedKey);

    const entryHTML = document.createElement("div");
    entryHTML.className = "entry";
    entryHTML.innerHTML = `
  <h3>${entry.title}</h3>
  ${entry.imageUrl ? `<img src="${entry.imageUrl}" class="diary-image">` : ""}
`;

// ‚ñº byË°åÔºà„Ç¢„Ç§„Ç≥„É≥Ôºã„ÉÜ„Ç≠„Çπ„ÉàÔºâ
const byline = document.createElement("div");
byline.className = "byline";

const avatarImg = document.createElement("img");
avatarImg.className = "avatar";
avatarImg.alt = "avatar";
// Êú™Ë®≠ÂÆöÊôÇ„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºà‰ªªÊÑè„ÅÆ1Êûö„Å´„Åó„Å¶OKÔºâ
avatarImg.src = "image/avatars/„Éó„É≠„Éï„Ç£„Éº„É´-01.svg";

const byText = document.createElement("small");
byText.innerHTML = `by ${entry.name} ÔΩú ${formatDate(entry.date)}`;

byline.appendChild(avatarImg);
byline.appendChild(byText);
entryHTML.appendChild(byline);

// „Éó„É≠„Éï„Ç£„Éº„É´„Åã„Çâ„Ç¢„Ç§„Ç≥„É≥Â∑Æ„ÅóÊõø„Åà
(async ()=>{
  const prof = await getProfile(entry.uid);
  if (prof?.iconUrl) avatarImg.src = prof.iconUrl;
})();


    const expandable = createExpandableContent(entry.content);
    (entryHTML.querySelector("h3") || entryHTML).insertAdjacentElement("afterend", expandable);
    container.appendChild(entryHTML);

    if (isOwner) {
  const deleteBtn = document.createElement("button");
  deleteBtn.textContent = "„Åì„ÅÆÊäïÁ®ø„ÇíÂâäÈô§";
  deleteBtn.className = "delete-btn";
  deleteBtn.addEventListener("click", async () => {
    const ok = confirm("„Åì„ÅÆÊäïÁ®ø„ÇíÂâäÈô§„Åô„ÇãÔºü");
    if (!ok) return;
    await window.deleteDoc(window.doc(window.db, "diaries", entry.id));
    await loadEntries();
    displayEntry();
  });

  const editBtn = document.createElement("button");
  editBtn.textContent = "Á∑®ÈõÜ";
  editBtn.className = "edit-btn";
  editBtn.addEventListener("click", () => {
    openEditModal(entry);
  });

  // ‚ñº byË°å„ÅÆ‚ÄúÁõ¥‰∏ã‚Äù„Å´„Éú„Çø„É≥Ë°å„ÇíÂ∑Æ„ÅóËæº„ÇÄ
  const actions = document.createElement("div");
  actions.className = "entry-actions";
  actions.appendChild(deleteBtn);
  actions.appendChild(editBtn);

  // ‚ñº ÊäïÁ®ø„Ç´„Éº„Éâ„ÅÆÊú´Â∞æ„Å´„Éú„Çø„É≥„ÇíËøΩÂä†
entryHTML.appendChild(actions);

}


    const commentIcon = entryHTML.querySelector(".comment-icon");
    if (commentIcon) {
      commentIcon.addEventListener("click", () => {
        openCommentModal(entry.id);
      });
    }

    const commentCountSpan = document.createElement("span");
    commentCountSpan.className = "comment-count";
    commentCountSpan.textContent = "...";

    const commentRef = window.collection(window.db, "diaries", entry.id, "comments");
    window.getDocs(commentRef).then(snap => {
      commentCountSpan.textContent = snap.size;
    });

    const tagsContainer = entryHTML.querySelector(".tags");
    if (tagsContainer) {
      tagsContainer.appendChild(commentCountSpan);
    }

    displayThumbnails();
  }

  async function loadComments(entryId) {
    const list = document.getElementById("comment-list");
    list.innerHTML = "Ë™≠„ÅøËæº„Åø‰∏≠‚Ä¶";
    const ref = window.collection(window.db, "diaries", entryId, "comments");
    const snap = await window.getDocs(ref);
    const comments = [];
    snap.forEach(doc => comments.push(doc.data()));
    list.innerHTML = comments.length
      ? comments.map(c => `<p>üó® <strong>${c.name}</strong>Ôºö${c.text} <small>Ôºà${formatDate(c.date)}Ôºâ</small></p>`).join("")
      : "<p>„Ç≥„É°„É≥„Éà„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</p>";
  }

  function displayThumbnails() {
    let bar = document.getElementById("thumbnail-bar");
    if (!bar) {
      bar = document.createElement("div");
      bar.id = "thumbnail-bar";
      bar.className = "thumbnail-bar";
      document.body.appendChild(bar);
    }
    bar.innerHTML = "";

    filteredData.forEach((entry, index) => {
      const div = document.createElement("div");
      div.className = "thumbnail-item";
      let contentPreview = entry.content.replace(/\n/g, " ").slice(0, 30);
      if (contentPreview.length === 30) contentPreview += "‚Ä¶";

      div.innerHTML = entry.imageUrl
        ? `<img src="${entry.imageUrl}" class="thumbnail-image" />
           <div class="thumbnail-text">${entry.title}<br><small>${entry.name}</small></div>`
        : `<div class="thumbnail-text"><strong>${entry.title}</strong><br>${contentPreview}<br><small>${entry.name}</small></div>`;

      div.addEventListener("click", () => {
        currentIndex = index;
        displayEntry();
      });
      bar.appendChild(div);
    });
  }

  // Ê§úÁ¥¢„Éª„Çø„Ç∞
  document.getElementById("searchBtn")?.addEventListener("click", () => {
    const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
    if (!keyword) return alert("Ê§úÁ¥¢„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Å™ÔºÅ");
    filteredData = diaryData.filter(e =>
      e.title.toLowerCase().includes(keyword) ||
      e.content.toLowerCase().includes(keyword) ||
      (e.tags || []).join(",").toLowerCase().includes(keyword)
    );
    currentIndex = 0;
    displayEntry();
  });

  document.getElementById("clearBtn")?.addEventListener("click", () => {
    filteredData = [...diaryData];
    currentIndex = 0;
    document.getElementById("searchInput").value = "";
    displayEntry();
  });

  document.addEventListener("click", (e) => {
    if (e.target.classList.contains("tag")) {
      const tag = e.target.dataset.tag.toLowerCase();
      document.getElementById("searchInput").value = tag;
      filteredData = diaryData.filter(e => (e.tags || []).some(t => t.toLowerCase() === tag));
      currentIndex = 0;
      displayEntry();
    }
  });

  // „É°„Éã„É•„Éº„Éª„Éï„Ç©„Éº„É†ÈñãÈñâ
  document.getElementById("menuToggle")?.addEventListener("click", () => {
    const menu = document.getElementById("menuItems");
    const icon = document.getElementById("menuToggle");
    menu.classList.toggle("active");
    icon.classList.toggle("flipped");
  });

  const formWrapper = document.querySelector(".form-wrapper");
const iconPost = document.getElementById("iconPost");

iconPost.addEventListener("click", () => {
  formWrapper.classList.toggle("active");
});


  document.getElementById("iconTag")?.addEventListener("click", () => {
    const input = document.getElementById("searchInput");
    input.scrollIntoView({ behavior: "smooth", block: "center" });
    input.focus();
  });

  document.getElementById("iconFavorite")?.addEventListener("click", () => {
    filteredData = diaryData.filter(entry => {
      const likedKey = `liked_${entry.id}`;
      return localStorage.getItem(likedKey);
    });
    currentIndex = 0;
    displayEntry();
  });

  // Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´
function openEditModal(entry) {
  editingEntryId  = entry.id;
  editingEntryUid = entry.uid || null;

  document.getElementById("editTitle").value    = entry.title   || "";
  document.getElementById("editContent").value  = entry.content || "";
  document.getElementById("editTags").value     = Array.isArray(entry.tags) ? entry.tags.join(", ") : (entry.tags || "");
  document.getElementById("editImageUrl").value = entry.imageUrl || ""; // ‚ÜêËøΩÂä†

  document.getElementById("editModal").classList.add("active");
}



function closeEditModal() {
  editingEntryId = null;
  editingEntryUid = null; // ‚ÜêËøΩÂä†
  document.getElementById("editModal").classList.remove("active");
}



  document.getElementById("saveEditBtn")?.addEventListener("click", async () => {
  try {
    const updatedTitle   = document.getElementById("editTitle").value.trim();
    const updatedContent = document.getElementById("editContent").value.trim();
    const updatedTagsRaw = document.getElementById("editTags").value;
    const updatedImageUrl = document.getElementById("editImageUrl").value.trim();


    if (!editingEntryId) return;

    // 1) Êú¨‰∫∫„ÉÅ„Çß„ÉÉ„ÇØÔºà‰øùÂ≠òÂâç„Å´ÂøÖ„ÅöÁ¢∫Ë™çÔºâ
    if (!window.currentUser || !editingEntryUid || window.currentUser.uid !== editingEntryUid) {
      alert("„Åì„ÅÆÊäïÁ®ø„ÇíÁ∑®ÈõÜ„Åô„ÇãÊ®©Èôê„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ");
      return;
    }

    // 2) „Çø„Ç∞„ÅØÈÖçÂàó„Å´Ê≠£Ë¶èÂåñÔºàÁ©∫Ë¶ÅÁ¥†„ÅØÈô§Â§ñÔºâ
    const updatedTags = updatedTagsRaw
      .split(",")
      .map(t => t.trim())
      .filter(Boolean);

    // 3) Firestore Êõ¥Êñ∞
    const entryRef = window.doc(window.db, "diaries", editingEntryId);
    await window.updateDoc(entryRef, {
      title: updatedTitle,
      content: updatedContent,
      tags: updatedTags,
      imageUrl: updatedImageUrl
    });

    // 4) UIÊõ¥Êñ∞Ôºà„É™„É≠„Éº„Éâ„Å™„ÅóÔºâ
    closeEditModal();
    await loadEntries();
    displayEntry();
  } catch (err) {
    console.error("Á∑®ÈõÜ„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:", err);
    alert("‰øùÂ≠ò‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ");
  }
});


  document.getElementById("cancelEditBtn")?.addEventListener("click", () => {
    closeEditModal();
  });

  // „Ç≥„É°„É≥„Éà„É¢„Éº„ÉÄ„É´
  function openCommentModal(postId) {
  const modal = document.getElementById("comment-modal");
  modal.classList.add("active"); // ‚Üê „Åì„Åì„Å†„ÅëÂ§âÊõ¥
  modal.dataset.postId = postId;
  loadComments(postId);
}

document.getElementById("close-comment-modal")?.addEventListener("click", () => {
  document.getElementById("comment-modal").classList.remove("active"); // ‚Üê „Åì„Åì„ÇÇÂ§âÊõ¥
});
document.getElementById("comment-cancel")?.addEventListener("click", () => {
  document.getElementById("comment-modal").classList.remove("active");
});

document.getElementById("comment-text")?.addEventListener("input", function () {
  this.style.height = "auto";
  this.style.height = this.scrollHeight + "px";
});

  document.getElementById("comment-submit")?.addEventListener("click", async () => {
    const name = document.getElementById("comment-name").value.trim() || "ÂåøÂêç„Åï„Çì";
    const text = document.getElementById("comment-text").value.trim();
    const postId = document.getElementById("comment-modal").dataset.postId;
    if (!text) return alert("„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Å™ÔºÅ");

    const comment = { name, text, date: new Date().toISOString() };

    try {
      const ref = window.collection(window.db, "diaries", postId, "comments");
      await window.addDoc(ref, comment);
      await loadComments(postId);
      document.getElementById("comment-name").value = "";
      document.getElementById("comment-text").value = "";
      document.getElementById("comment-modal").style.display = "none";
    } catch (err) {
      console.error("„Ç≥„É°„É≥„Éà‰øùÂ≠ò„Ç®„É©„ÉºÔºö", err);
      alert("„Ç≥„É°„É≥„Éà„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åü„Åß‚Ä¶");
    }
  });

    // ‚Üê ‚òÖ„Åì„Åì„Çà„Çä‰∏ä„Å´ ÊäïÁ®øÂá¶ÁêÜ„ÅÆ„Ç≥„Éº„Éâ„ÇíËøΩÂä†ÔºÅ„Åì„ÅÆ„Ç≥„É°„É≥„ÉàÊé¢„Åó„Å¶„Å≠ÔºÅ

  // ÊäïÁ®øÂá¶ÁêÜ
  document.getElementById("submitBtn")?.addEventListener("click", async (e) => {
    e.preventDefault();

    const name = document.getElementById("username").value.trim() || "ÂåøÂêç„Åï„Çì";
    const title = document.getElementById("title").value.trim();
    const content = document.getElementById("content").value.trim();
    const tags = document.getElementById("tags").value.split(",").map(t => t.trim()).filter(t => t);
    const imageFile = document.getElementById("imageInput").files[0];

    if (!title || !content) {
      alert("„Çø„Ç§„Éà„É´„Å®Êú¨Êñá„ÅØÂøÖÈ†à„ÇÑ„ÅßÔºÅ");
      return;
    }

    const post = {
      name,
      title,
      content,
      tags,
      date: new Date().toISOString(),
      uid: window.currentUser?.uid || null,
      likes: 0,
    };

    try {
      if (imageFile) {
        const formData = new FormData();
        formData.append("file", imageFile);
        formData.append("upload_preset", "todoku_upload");

        const res = await fetch("https://api.cloudinary.com/v1_1/dvzapaede/image/upload", {
          method: "POST",
          body: formData,
        });

        const data = await res.json();
        post.imageUrl = data.secure_url;
      }

      await window.addDoc(window.collection(window.db, "diaries"), post);

      // ÂÖ•ÂäõÊ¨Ñ„Çí„É™„Çª„ÉÉ„Éà
      document.getElementById("username").value = "";
      document.getElementById("title").value = "";
      document.getElementById("content").value = "";
      document.getElementById("tags").value = "";
      document.getElementById("imageInput").value = "";
      document.querySelector(".form-wrapper")?.classList.remove("active");

      await loadEntries();
      displayEntry();

    } catch (err) {
      console.error("ÊäïÁ®ø„Ç®„É©„ÉºÔºö", err);
      alert("ÊäïÁ®ø„Å´Â§±Êïó„Åó„Åü„Åß‚Ä¶");
    }
  });

  // ÊäïÁ®ø„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÔºÜË°®Á§∫ ‚Üê‚òÖ„Åì„ÅÆ‰∏ã„ÅØ„ÇÇ„Å®„ÇÇ„Å®„ÅÇ„Çã„ÇÑ„Å§
  (async () => {
    await loadEntries();
    displayEntry();
  })();
});
// üìå Êú¨ÊñáÊ¨Ñ„ÅÆÈ´ò„ÅïËá™ÂãïË™øÊï¥
const contentTextarea = document.getElementById("content");

contentTextarea.addEventListener("input", () => {
  contentTextarea.style.height = "auto"; // ‰∏ÄÂ∫¶„É™„Çª„ÉÉ„Éà
  contentTextarea.style.height = contentTextarea.scrollHeight + "px"; // ÂÜÖÂÆπ„Å´Âêà„Çè„Åõ„Å¶È´ò„ÅïË™øÊï¥
});


/***** ÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÔºàCloudinary unsignedÔºâ *****/
const CLOUD_NAME   = "dvzapaede";
const UPLOAD_PRESET= "todoku_upload";

const pickImageBtn  = document.getElementById("pickImageBtn");
const editImageFile = document.getElementById("editImageFile");
const editImageUrl  = document.getElementById("editImageUrl");
const uploadHint    = document.getElementById("uploadHint");

pickImageBtn?.addEventListener("click", () => {
  editImageFile?.click();
});

editImageFile?.addEventListener("change", async (e) => {
  const file = e.target.files && e.target.files[0];
  if (!file) return;

  try {
    uploadHint && (uploadHint.textContent = "„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ‰∏≠‚Ä¶");
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", UPLOAD_PRESET);

    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/upload`, {
      method: "POST",
      body: formData
    });
    if (!res.ok) throw new Error("Cloudinary upload failed");
    const json = await res.json();

    // ÂèñÂæó„Åó„ÅüURL„ÇíÂÖ•ÂäõÊ¨Ñ„Å´ÂèçÊò†
    if (editImageUrl) editImageUrl.value = json.secure_url || json.url || "";
    uploadHint && (uploadHint.textContent = "„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂÆå‰∫ÜÔºÅ");
  } catch (err) {
    console.error(err);
    uploadHint && (uploadHint.textContent = "„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂ§±Êïó„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ");
    alert("ÁîªÂÉè„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÈÄö‰ø°Áä∂Ê≥Å„Çí„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ");
  } finally {
    // ÈÅ∏ÊäûÁä∂ÊÖã„ÅØ„ÇØ„É™„Ç¢„Åó„Å¶„Åä„Åè
    if (editImageFile) editImageFile.value = "";
  }
});
